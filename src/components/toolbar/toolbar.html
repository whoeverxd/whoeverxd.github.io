<template>
  <div class="toolbar-row">
    <!-- Game Dropdown -->

    <div class="toolbar-dropdown toolbar-row-box">
      <button class="toolbar-btn" click.trigger="isGameOpen = !isGameOpen">
        <img src="/src/assets/icons/sword.svg" alt="Game Icon" class="toolbar-icon" />
        <span class="toolbar-selected">
          ${selectedGame && selectedGame !== 'All'
          ? (games.find(g => g.id == selectedGame)?.name || selectedGame)
          : 'Select a game'}
        </span>
        <svg class="toolbar-arrow${isGameOpen ? ' open' : ''}" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9" />
        </svg>
      </button>
      <ul if.bind="isGameOpen" class="toolbar-dropdown-list">
        <li class="toolbar-dropdown-item" click.trigger="selectGame('All')">All</li>
        <li repeat.for="game of games" class="toolbar-dropdown-item" click.trigger="selectGame(game.id)">${game.name}</li>
      </ul>
    </div>
    <!-- Search -->

    <div class="toolbar-search toolbar-row-box">
      <img src="/src/assets/icons/search.svg" alt="Search Icon" class="toolbar-search-icon" />
      <input type="text" class="toolbar-search-input" value.bind="search" placeholder="Search"
        input.trigger="onSearch()" />

    </div>

    <!-- Price Dropdown -->

    <div class="toolbar-dropdown toolbar-row-box">
      <button class="toolbar-btn" click.trigger="isPriceOpen = !isPriceOpen">
        <img src="/src/assets/icons/money-sack.svg" alt="Price Icon" class="toolbar-icon" />
        <span class="toolbar-label">Price</span>
        <span class="toolbar-selected">${selectedPrice || 'All'}</span>
        <svg class="toolbar-arrow${isPriceOpen ? ' open' : ''}" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9" />
        </svg>
      </button>
      <ul if.bind="isPriceOpen" class="toolbar-dropdown-list">
        <li class="toolbar-dropdown-item" click.trigger="selectPrice('All')">All</li>
        <li repeat.for="price of priceOptions" class="toolbar-dropdown-item" click.trigger="selectPrice(price)">
          ${price}
        </li>
      </ul>
    </div>

    <!-- Item Type Dropdown -->

    <div class="toolbar-dropdown toolbar-row-box">
      <button class="toolbar-btn" click.trigger="isTypeOpen = !isTypeOpen">
        <img src="/src/assets/icons/leaf.svg" alt="Type Icon" class="toolbar-icon" />
        <span class="toolbar-label">Item Type</span>
        <span class="toolbar-selected">${selectedType || 'All'}</span>
        <svg class="toolbar-arrow${isTypeOpen ? ' open' : ''}" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9" />
        </svg>
      </button>
      <ul if.bind="isTypeOpen" class="toolbar-dropdown-list">
        <li class="toolbar-dropdown-item" click.trigger="selectType('All')">All</li>
        <li repeat.for="type of typeOptions" class="toolbar-dropdown-item" click.trigger="selectType(type)">${type}
        </li>
      </ul>
    </div>
    <!-- Filters button for small screens -->
    <button class="filters-btn toolbar-row-box" click.trigger="toggleFilters()">
      <img src="/src/assets/icons/filter.svg" alt="Filter Icon" class="toolbar-icon" />
      <span>Filters</span>
    </button>
  </div>
  <!-- Bottom sheet filters panel -->
  <div if.bind="isFiltersOpen">
    <div class="filters-overlay" click.trigger="closeFilters()"></div>
    <div class="filters-panel" role="dialog" aria-modal="true">
      <div class="filters-header">
        <h3>Filters</h3>
        <button class="filters-close" aria-label="Close" click.trigger="closeFilters()">âœ•</button>
      </div>
      <div class="filters-section">
        <h4>Game</h4>
        <ul class="filters-list">
          <li class="filters-item ${selectedGame === 'All' || !selectedGame ? 'selected' : ''}" click.trigger="selectGame('All')">All</li>
          <li repeat.for="game of games" class="filters-item ${selectedGame == game.id ? 'selected' : ''}" click.trigger="selectGame(game.id)">${game.name}</li>
        </ul>
      </div>
      <div class="filters-section">
        <h4>Price</h4>
        <ul class="filters-list">
          <li class="filters-item ${selectedPrice === 'All' || !selectedPrice ? 'selected' : ''}" click.trigger="selectPrice('All')">All</li>
          <li repeat.for="price of priceOptions" class="filters-item ${selectedPrice == price ? 'selected' : ''}" click.trigger="selectPrice(price)">${price}</li>
        </ul>
      </div>
      <div class="filters-section">
        <h4>Item Type</h4>
        <ul class="filters-list">
          <li class="filters-item ${selectedType === 'All' || !selectedType ? 'selected' : ''}" click.trigger="selectType('All')">All</li>
          <li repeat.for="type of typeOptions" class="filters-item ${selectedType == type ? 'selected' : ''}" click.trigger="selectType(type)">${type}</li>
        </ul>
      </div>
      <div class="filters-actions">
        <button class="filters-apply" click.trigger="closeFilters()">Apply</button>
      </div>
    </div>
  </div>
</template>